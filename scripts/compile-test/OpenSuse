FROM opensuse/tumbleweed:latest as hotspot_opensuse_intermediate

# install dependencies

RUN zypper --non-interactive update && \
    zypper --non-interactive install \
    cmake gcc-c++ glibc-devel-static git ninja binutils gettext \
    libzstd-devel libelf-devel libdw-devel qcustomplot-devel \
    libqt5-qtx11extras-devel libQt5Widgets-devel libqt5-qtbase-devel libqt5-qtsvg-devel \
    libQt5Widgets-private-headers-devel \
    extra-cmake-modules threadweaver-devel kio-devel \
    solid-devel kcoreaddons-devel threadweaver-devel kconfigwidgets-devel \
    kitemmodels-devel kitemviews-devel kwindowsystem-devel kparts-devel \
    knotifications-devel kiconthemes-devel karchive-devel

WORKDIR /opt

# install build dependencies

RUN git clone -b 1.6 https://github.com/KDAB/KDDockWidgets && \
    cd KDDockWidgets && mkdir build && cd build && \
    cmake -DCMAKE_BUILD_TYPE=Debug -DCMAKE_INSTALL_PREFIX=/usr/ -G Ninja .. && \
    cmake --build . --target install

FROM hotspot_opensuse_intermediate

ADD . /opt/hotspot/

RUN cd hotspot && mkdir build && cd build && \
    cmake -DCMAKE_BUILD_TYPE=Debug -G Ninja \
        -DCMAKE_INSTALL_PREFIX=/usr/ \
        -DCMAKE_CXX_FLAGS_DEBUG="-g -fsanitize=address,undefined" \
        -DCMAKE_C_FLAGS_DEBUG="-g -fsanitize=address,undefined" .. && \
    cmake --build .
