FROM archlinux:latest as hotspot_archlinux_intermediate

# install dependencies

RUN pacman -Syu --noconfirm git make qt5-x11extras cmake gcc extra-cmake-modules \
    libelf gettext qt5-base ninja qcustomplot \
    threadweaver kconfigwidgets knotifications karchive \
    kiconthemes kitemviews kitemmodels kwindowsystem kio kparts solid

WORKDIR /opt

# install build dependencies

RUN git clone -b 1.6 https://github.com/KDAB/KDDockWidgets && \
    cd KDDockWidgets && mkdir build && cd build && \
    cmake -DCMAKE_BUILD_TYPE=Debug -DCMAKE_INSTALL_PREFIX=/usr/ -G Ninja .. && \
    cmake --build . --target install

FROM hotspot_archlinux_intermediate

ADD . /opt/hotspot/

RUN cd hotspot && mkdir build && cd build && \
    cmake -DCMAKE_BUILD_TYPE=Debug -G Ninja \
        -DCMAKE_INSTALL_PREFIX=/usr/ \
        -DCMAKE_CXX_FLAGS_DEBUG="-g -fsanitize=address,undefined" \
        -DCMAKE_C_FLAGS_DEBUG="-g -fsanitize=address,undefined" .. && \
    cmake --build .
